<!DOCTYPE html>
<!--
    Stub client that connects to an HITL server by IP address, sends the "client ready!" message, receives server messages, and displays the incoming message rate. It does not send client state or attempt to render received gfx-replay keyframes.
-->
<html>
<head>
    <title>WebSocket Client</title>
    <style>
        #status {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <label for="serverIp">Server IP:</label>
    <input type="text" id="serverIp" value="0.0.0.0">
    <label for="serverPort">Port:</label>
    <input type="text" id="serverPort" value="8888">
    <button id="connectButton">Connect</button>
    <button id="disconnectButton" disabled>Disconnect</button>
    <div id="serverUrl"></div>
    <div id="status">Disconnected</div>
    <div id="messageRate">Message Rate: 0</div>

    <script>
        var ws = null;
        var messageCount = 0;
        var lastUpdateTime = Date.now();

        function connect() {
            var ip = document.getElementById('serverIp').value;
            var port = document.getElementById('serverPort').value;
            var url = 'ws://' + ip + ':' + port;
            document.getElementById('serverUrl').textContent = 'Server URL: ' + url;
            ws = new WebSocket(url);

            ws.onopen = function() {
                document.getElementById('status').textContent = 'Connected';
                document.getElementById('connectButton').disabled = true;
                document.getElementById('disconnectButton').disabled = false;
                document.getElementById('serverIp').disabled = true;
                document.getElementById('serverPort').disabled = true;
                ws.send('client ready!');  // Send "client ready!" to the server
            };

            ws.onclose = function() {
                document.getElementById('status').textContent = 'Disconnected';
                document.getElementById('connectButton').disabled = false;
                document.getElementById('disconnectButton').disabled = true;
                document.getElementById('serverIp').disabled = false;
                document.getElementById('serverPort').disabled = false;
            };

            ws.onmessage = function() {
                messageCount++;
            };
        }

        function disconnect() {
            if (ws) {
                ws.close();
            }
        }

        function updateMessageRate() {
            var now = Date.now();
            var deltaTime = (now - lastUpdateTime) / 1000;  // Convert to seconds
            var messageRate = messageCount / deltaTime;
            document.getElementById('messageRate').textContent = 'Message Rate: ' + messageRate.toFixed(1);
            messageCount = 0;
            lastUpdateTime = now;
        }

        document.getElementById('connectButton').addEventListener('click', connect);
        document.getElementById('disconnectButton').addEventListener('click', disconnect);
        setInterval(updateMessageRate, 2000);  // Update message rate every 2 seconds
    </script>
</body>
</html>
